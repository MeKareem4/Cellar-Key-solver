<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cellar Key Decoder - A Dream You've Had Before</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Inter:wght@400;600&display=swap');
        
        body {
            background-color: #0d0d0f;
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
            background-image: radial-gradient(circle at top center, #1a1a2e 0%, #0d0d0f 100%);
        }

        .dream-font {
            font-family: 'Courier Prime', monospace;
        }

        .glass {
            background: rgba(30, 30, 40, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        .input-glow:focus {
            outline: none;
            border-color: #818cf8;
            box-shadow: 0 0 20px rgba(129, 140, 248, 0.2);
        }

        .status-pill {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex flex-col items-center">
    <div class="w-full max-w-2xl">
        <!-- Header -->
        <header class="mb-10 text-center">
            <h1 class="text-3xl md:text-5xl font-bold mb-3 dream-font text-white tracking-[0.2em] uppercase">The Basement</h1>
            <p class="text-indigo-400 text-sm tracking-widest uppercase opacity-80">Cellar Key Deciphering Unit</p>
        </header>

        <!-- Tool -->
        <div class="glass rounded-3xl p-6 md:p-10">
            <section class="mb-8">
                <div class="flex justify-between items-center mb-4">
                    <label class="text-xs font-bold text-gray-400 uppercase tracking-widest">Input Number Sequence</label>
                    <div class="status-pill bg-indigo-500/20 text-indigo-400 border border-indigo-500/30">A1Z26 Enabled</div>
                </div>

                <textarea 
                    id="numberInput"
                    placeholder="Example: 19 1 25 0 19 5 22 5 14 0 26 5 18 15..."
                    class="w-full h-40 bg-black/40 border border-white/10 rounded-2xl p-5 dream-font text-lg text-indigo-200 input-glow transition-all resize-none mb-4"
                ></textarea>
                
                <div class="flex flex-col sm:flex-row gap-3">
                    <button onclick="decodeSequence()" class="flex-[2] bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded-xl transition-all active:scale-95 uppercase tracking-widest text-sm shadow-lg shadow-indigo-500/20">
                        Analyze & Decode
                    </button>
                    <button onclick="clearAll()" class="flex-1 bg-white/5 hover:bg-white/10 text-gray-400 py-4 rounded-xl transition-all text-sm uppercase tracking-widest border border-white/5">
                        Reset
                    </button>
                </div>
            </section>

            <!-- Results -->
            <section id="resultArea" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div class="space-y-6 pt-6 border-t border-white/10">
                    <div>
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-[10px] font-bold text-gray-500 uppercase">Layer 1: Text Translation</span>
                            <div id="zeroBadge" class="hidden status-pill bg-green-500/20 text-green-400 border border-green-500/30">ZERO Marker Found</div>
                        </div>
                        <div id="decodedLetters" class="p-4 bg-black/30 rounded-xl dream-font text-gray-400 break-words text-xs leading-relaxed border border-white/5"></div>
                    </div>

                    <div class="p-8 bg-indigo-600/10 border border-indigo-500/40 rounded-2xl relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-2 opacity-10">
                            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7 11V7a5 5 0 0 1 10 0v4"/><rect x="3" y="11" width="18" height="11" rx="2"/></svg>
                        </div>
                        <h3 class="text-xs font-bold text-indigo-400 uppercase tracking-widest mb-4">Final Secret Phrase</h3>
                        <div id="finalKey" class="text-4xl font-bold text-white dream-font tracking-tight mb-4 break-words"></div>
                        <button onclick="copyKey()" class="flex items-center gap-2 text-xs font-bold text-indigo-300 hover:text-white transition-colors group">
                            <svg class="group-hover:rotate-12 transition-transform" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                            <span>Copy to clipboard</span>
                        </button>
                    </div>
                </div>
            </section>

            <div id="statusMsg" class="mt-6 p-4 rounded-xl bg-red-500/10 border border-red-500/20 text-sm text-center text-red-400 hidden"></div>
        </div>

        <!-- Reference Footer -->
        <footer class="mt-8 text-center text-gray-600 text-[10px] uppercase tracking-[0.3em]">
            A1Z26 Cipher Engine â€¢ Updated Logic v2.0
        </footer>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 px-8 py-3 bg-white text-black rounded-full text-xs font-black uppercase tracking-widest opacity-0 transition-all duration-300 pointer-events-none shadow-2xl">
        Copied to Clipboard
    </div>

    <script>
        const alphabet = " ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        
        // Dictionary ordered by length descending to ensure "SEVENTEEN" is matched before "SEVEN"
        const numMap = [
            {w: "TWENTYSIX", n: 26}, {w: "TWENTYFIVE", n: 25}, {w: "TWENTYFOUR", n: 24},
            {w: "TWENTYTHREE", n: 23}, {w: "TWENTYTWO", n: 22}, {w: "TWENTYONE", n: 21},
            {w: "NINETEEN", n: 19}, {w: "EIGHTEEN", n: 18}, {w: "SEVENTEEN", n: 17},
            {w: "SIXTEEN", n: 16}, {w: "FIFTEEN", n: 15}, {w: "FOURTEEN", n: 14},
            {w: "THIRTEEN", n: 13}, {w: "TWELVE", n: 12}, {w: "ELEVEN", n: 11},
            {w: "TWENTY", n: 20}, {w: "ZERO", n: 0}, {w: "ONE", n: 1}, {w: "TWO", n: 2},
            {w: "THREE", n: 3}, {w: "FOUR", n: 4}, {w: "FIVE", n: 5}, {w: "SIX", n: 6},
            {w: "SEVEN", n: 7}, {w: "EIGHT", n: 8}, {w: "NINE", n: 9}, {w: "TEN", n: 10}
        ];

        function decodeSequence() {
            const input = document.getElementById('numberInput').value.trim();
            const statusMsg = document.getElementById('statusMsg');
            const resultArea = document.getElementById('resultArea');
            const zeroBadge = document.getElementById('zeroBadge');
            
            if (!input) {
                showError("The system requires a sequence to analyze.");
                return;
            }

            try {
                // Layer 1: A1Z26 Conversion
                const rawNumbers = input.split(/[\s,.\-]+/).filter(v => v !== "");
                let layer1Text = "";
                
                rawNumbers.forEach(val => {
                    let n = parseInt(val);
                    if (n === 0) layer1Text += " ";
                    else if (n >= 1 && n <= 26) layer1Text += alphabet[n];
                });

                document.getElementById('decodedLetters').innerText = layer1Text;
                
                // Visual feedback for ZERO marker
                if (layer1Text.includes("ZERO")) zeroBadge.classList.remove('hidden');
                else zeroBadge.classList.add('hidden');

                // Layer 2: Intelligent Word Scanning
                // Normalize: remove spaces and handle "SAY"
                let cleanText = layer1Text.toUpperCase().replace(/\s/g, '');
                if (cleanText.startsWith("SAY")) cleanText = cleanText.substring(3);

                let foundNumbers = [];
                let cursor = 0;

                while (cursor < cleanText.length) {
                    let match = null;

                    // Try to match the longest possible number word at the current cursor position
                    for (const entry of numMap) {
                        if (cleanText.startsWith(entry.w, cursor)) {
                            match = entry;
                            break; // numMap is already sorted by length
                        }
                    }

                    if (match) {
                        foundNumbers.push(match.n);
                        cursor += match.w.length;
                    } else {
                        // Skip if no match found (junk characters or incomplete words)
                        cursor++;
                    }
                }

                // Layer 3: Convert identified numbers back to final characters
                let finalPhrase = "";
                foundNumbers.forEach(n => {
                    if (n === 0) finalPhrase += " ";
                    else if (n >= 1 && n <= 26) finalPhrase += alphabet[n].toLowerCase();
                });

                let result = finalPhrase.trim();

                if (!result) {
                    showError("Sequence analysis failed. No number-words (ONE, TWO, etc.) were detected.");
                    return;
                }

                document.getElementById('finalKey').innerText = result;
                resultArea.classList.remove('hidden');
                statusMsg.classList.add('hidden');

            } catch (err) {
                showError("System Error: Critical failure during sequence interpretation.");
            }
        }

        function showError(msg) {
            const statusMsg = document.getElementById('statusMsg');
            statusMsg.innerText = msg;
            statusMsg.classList.remove('hidden');
            document.getElementById('resultArea').classList.add('hidden');
        }

        function clearAll() {
            document.getElementById('numberInput').value = "";
            document.getElementById('resultArea').classList.add('hidden');
            document.getElementById('statusMsg').classList.add('hidden');
            document.getElementById('zeroBadge').classList.add('hidden');
        }

        function copyKey() {
            const text = document.getElementById('finalKey').innerText;
            const textarea = document.createElement("textarea");
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showToast();
            } catch (err) {
                console.error('Copy failed', err);
            }
            document.body.removeChild(textarea);
        }

        function showToast() {
            const toast = document.getElementById('toast');
            toast.style.opacity = '1';
            toast.style.bottom = '40px';
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.bottom = '30px';
            }, 2000);
        }
    </script>
</body>
</html>
